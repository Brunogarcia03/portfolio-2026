---
import Github from "@/assets/Github.astro";
import Instagram from "@/assets/Instagram.astro";
import Linkedin from "@/assets/Linkedin.astro";
import Layout from "@/layouts/Layout.astro";

import contact_gif from "@/assets/contact.gif";
import Footer from "@/components/Footer.astro";
---

<Layout title="Contacto. Gracias por escribir">
  <div
    class="absolute inset-0 max-w-[650px] mx-auto max-[690px]:mx-4 pointer-events-none overflow-hidden"
  >
    <svg
      data-direction="left"
      data-variant="full-screen"
      class="absolute pointer-events-none z-10 text-[#ddb3ff] dark:text-neutral-600 left-0 top-0 h-full"
      width="1"
      height="100%"
      viewBox="0 0 1 100"
      preserveAspectRatio="none"
      style="width:1px"
      ><line
        x1="0.5"
        y1="0"
        x2="0.5"
        y2="100"
        stroke="currentColor"
        stroke-width="1"
        stroke-dasharray="6 6"
        vector-effect="non-scaling-stroke"></line></svg
    ><svg
      data-direction="right"
      data-variant="full-screen"
      class="absolute pointer-events-none z-10 text-[#ddb3ff] dark:text-neutral-600 right-0 top-0 h-full"
      width="1"
      height="100%"
      viewBox="0 0 1 100"
      preserveAspectRatio="none"
      style="width:1px"
      ><line
        x1="0.5"
        y1="0"
        x2="0.5"
        y2="100"
        stroke="currentColor"
        stroke-width="1"
        stroke-dasharray="6 6"
        vector-effect="non-scaling-stroke"></line></svg
    >
  </div>
  <main
    class="flex flex-col items-center justify-center max-w-[650px] w-full mx-auto min-h-screen py-5 lg:py-[100px]"
  >
    <div
      class="relative w-full flex items-center justify-between max-[690px]:px-8 px-4 py-4"
    >
      <svg
        data-direction="top"
        data-variant="full-screen"
        class="absolute pointer-events-none z-10 text-[#ddb3ff] dark:text-neutral-600 top-0 w-full"
        width="100%"
        height="1"
        viewBox="0 0 100 1"
        preserveAspectRatio="none"
        style="left:50%;transform:translateX(-50%);width:100vw"
        ><line
          x1="0"
          y1="0.5"
          x2="100"
          y2="0.5"
          stroke="currentColor"
          stroke-width="1"
          stroke-dasharray="6 6"
          vector-effect="non-scaling-stroke"></line></svg
      ><svg
        data-direction="bottom"
        data-variant="full-screen"
        class="absolute pointer-events-none z-10 text-[#ddb3ff] dark:text-neutral-600 bottom-0 w-full"
        width="100%"
        height="1"
        viewBox="0 0 100 1"
        preserveAspectRatio="none"
        style="left:50%;transform:translateX(-50%);width:100vw"
        ><line
          x1="0"
          y1="0.5"
          x2="100"
          y2="0.5"
          stroke="currentColor"
          stroke-width="1"
          stroke-dasharray="6 6"
          vector-effect="non-scaling-stroke"></line></svg
      >
      <div
        class="flex flex-col sm:flex-row items-center justify-between gap-y-4 w-full"
      >
        <div class="flex items-center md:gap-4 gap-2">
          <div
            class="animate-fade-in-fast relative size-[60px] md:size-20 bg-[#ddb3ff] dark:bg-neutral-600 flex items-center justify-center overflow-hidden rounded-[10px]"
          >
            <img
              class="absolute w-full h-full object-fill scale-110"
              src={contact_gif.src}
              alt=""
            />
          </div>
          <div class="flex flex-col">
            <h1
              class="md:text-xl text-lg font-medium animate-fade-in text-neutral-800 dark:text-neutral-300"
            >
              <span class="text-slate-600 dark:text-slate-400">200</span> ¡Gracias
              por escribir!
            </h1><a
              href="/"
              class="animate-fade-in-slow group md:text-base text-sm font-regular md:leading-6 leading-5 text-neutral-600 dark:text-neutral-400 flex items-center gap-1.5"
            >
              Volver al inicio <svg
                class="size-3 shrink-0 text-neutral-300 group-hover:text-neutral-700 -rotate-90 sm:-rotate-45 group-hover:-rotate-90 transition-all duration-300 group-focus-visible:text-neutral-700 group-focus-visible:-rotate-90"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                ><path
                  d="M7 17L17 7M17 7H7M17 7V17"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"></path></svg
              >
            </a>
          </div>
        </div><div
          class="flex items-center sm:flex-col justify-around sm:justify-start gap-2 sm:gap-1 sm:mt-0 mt-4"
        >
          <a
            target="_blank"
            href="https://www.instagram.com/brugarciaok/"
            class="animate-fade-in-fast flex items-center justify-center sm:justify-start w-full gap-1.5 text-sm font-medium text-neutral-600 dark:text-neutral-400 py-1 cursor-pointer hover:underline underline-offset-3 focus-visible:underline"
            ><Instagram classname="size-4" /> Instagram</a
          ><a
            target="_blank"
            href="https://github.com/Brunogarcia03"
            class="animate-fade-in flex items-center justify-center sm:justify-start w-full gap-1.5 text-sm font-medium text-neutral-600 dark:text-neutral-400 py-1 cursor-pointer hover:underline underline-offset-3 focus-visible:underline"
            ><Github
              classname="size-4"
              fill="fill-neutral-700 dark:fill-neutral-300"
            /> Github</a
          >
          <a
            target="_blank"
            href="https://www.linkedin.com/in/bruno-garc%C3%ADa/"
            class="animate-fade-in-slow flex items-center justify-center sm:justify-start w-full gap-1.5 text-sm font-medium text-neutral-600 dark:text-neutral-400 py-1 cursor-pointer hover:underline underline-offset-3 focus-visible:underline"
            ><Linkedin classname="size-4" /> Linkedin</a
          >
        </div>
      </div>
    </div>
    <div
      class="relative w-full flex items-center justify-between max-[690px]:px-8 px-4 py-4"
    >
      <svg
        data-direction="bottom"
        data-variant="full-screen"
        class="absolute pointer-events-none z-10 text-[#ddb3ff] dark:text-neutral-600 bottom-0 w-full"
        width="100%"
        height="1"
        viewBox="0 0 100 1"
        preserveAspectRatio="none"
        style="left:50%;transform:translateX(-50%);width:100vw"
        ><line
          x1="0"
          y1="0.5"
          x2="100"
          y2="0.5"
          stroke="currentColor"
          stroke-width="1"
          stroke-dasharray="6 6"
          vector-effect="non-scaling-stroke"></line></svg
      >
      <form
        id="contact-form"
        class="flex flex-col items-center gap-y-4 max-w-lg mx-auto w-full"
      >
        <div class="relative z-0 w-full group">
          <input
            type="email"
            name="floating_email"
            id="floating_email"
            class="animate-fade-in-fast block py-2.5 px-0 w-full text-sm text-heading bg-transparent border-0 border-neutral-600 dark:border-neutral-400 text-neutral-600 dark:text-neutral-400 border-b border-default-medium appearance-none focus:outline-none focus:ring-0 focus:border-brand peer"
            placeholder=" "
            required
          />
          <label
            for="floating_email"
            class="animate-fade-in-fast absolute text-sm text-neutral-600 dark:text-neutral-400 text-body duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-left peer-focus:start-0 peer-focus:text-fg-brand peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto"
            >Email</label
          >
        </div>

        <div class="relative z-0 w-full group">
          <input
            type="text"
            name="floating_asunto"
            id="floating_asunto"
            class="animate-fade-in block py-2.5 px-0 w-full text-sm text-heading bg-transparent border-0 border-neutral-600 dark:border-neutral-400 text-neutral-600 dark:text-neutral-400 border-b border-default-medium appearance-none focus:outline-none focus:ring-0 focus:border-brand peer"
            placeholder=""
            required
          />
          <label
            for="floating_asunto"
            class="animate-fade-in absolute text-sm text-neutral-600 dark:text-neutral-400 text-body duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-left peer-focus:start-0 peer-focus:text-fg-brand peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto"
            >Asunto</label
          >
        </div>

        <div class="relative z-0 w-full group">
          <textarea
            id="message"
            rows="1"
            name="floating_message"
            id="floating_message"
            class="animate-fade-in-slow block py-2.5 px-0 w-full text-sm text-heading bg-transparent border-0 border-neutral-600 dark:border-neutral-400 text-neutral-600 dark:text-neutral-400 border-b border-default-medium appearance-none focus:outline-none focus:ring-0 focus:border-brand peer"
            placeholder=" "
            required></textarea>
          <label
            for="floating_message"
            class="animate-fade-in-slow absolute text-sm text-neutral-600 dark:text-neutral-400 text-body duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-left peer-focus:start-0 peer-focus:text-fg-brand peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto"
            >Mensaje</label
          >
        </div>

        <button
          class="animate-fade-in-slow w-full border border-default-medium rounded-[10px] py-3 border-neutral-600 dark:border-neutral-400 text-neutral-400 dark:text-neutral-600 transition-colors duration-200 hover:bg-neutral-600 dark:hover:bg-neutral-400 dark:hover:text-neutral-800 hover:text-neutral-300 cursor-pointer"
          type="submit"
        >
          Enviar mensaje
        </button>
        <div id="form-status" class="hidden text-sm h-6 flex items-center">
        </div>
      </form>
    </div>
    <Footer />
  </main>
</Layout>

<script is:inline>
  const form = document.getElementById("contact-form");
  const status = document.getElementById("form-status");

  const setStatus = (message, type) => {
    // type: "loading" | "success" | "error"
    const colors = {
      loading: "text-neutral-500 dark:text-neutral-400",
      success: "text-green-600 dark:text-green-400",
      error: "text-red-600 dark:text-red-400",
    };

    status.className = `block text-sm h-6 flex items-center opacity-0 transition-opacity duration-300 ${colors[type]}`;
    status.textContent = message;

    requestAnimationFrame(() => {
      status.classList.add("opacity-100");
    });
  };

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    setStatus("Enviando...", "loading");

    const payload = {
      email: form.floating_email.value,
      asunto: form.floating_asunto.value,
      mensaje: form.floating_message.value,
    };

    try {
      const res = await fetch("/api/send", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(payload),
      });

      const data = await res.json();

      if (res.ok) {
        setStatus("Mensaje enviado correctamente ✔️", "success");
        form.reset();
      } else {
        setStatus("Error al enviar el mensaje ❌", "error");
        console.error(data);
      }
    } catch (err) {
      setStatus("Error de conexión ❌", "error");
      console.error(err);
    }
  });
</script>
